<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="å¼•è¨€æ­¤æ–‡æ˜¯iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†ã€‚å°†ä¼šè¾…ä»¥ä¸€å®šçš„ä¾‹å­è®²è§£ä¸€äº›æ›´æ·±å±‚æ¬¡çš„APIä½¿ç”¨åŠæ³¨æ„äº‹é¡¹ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰">
<meta property="og:url" content="http://yoursite.com/2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/index.html">
<meta property="og:site_name" content="ğŸ°BiuBiuBiu~">
<meta property="og:description" content="å¼•è¨€æ­¤æ–‡æ˜¯iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†ã€‚å°†ä¼šè¾…ä»¥ä¸€å®šçš„ä¾‹å­è®²è§£ä¸€äº›æ›´æ·±å±‚æ¬¡çš„APIä½¿ç”¨åŠæ³¨æ„äº‹é¡¹ã€‚">
<meta property="og:image" content="http://i2.buimg.com/572363/3af4576fb2897c06.png">
<meta property="og:image" content="http://i2.buimg.com/572363/a0cc83549bcc31a1.png">
<meta property="og:updated_time" content="2016-08-28T09:33:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰">
<meta name="twitter:description" content="å¼•è¨€æ­¤æ–‡æ˜¯iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†ã€‚å°†ä¼šè¾…ä»¥ä¸€å®šçš„ä¾‹å­è®²è§£ä¸€äº›æ›´æ·±å±‚æ¬¡çš„APIä½¿ç”¨åŠæ³¨æ„äº‹é¡¹ã€‚">
<meta name="twitter:image" content="http://i2.buimg.com/572363/3af4576fb2897c06.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Zheng Li'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/"/>

  <title> iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰ | ğŸ°BiuBiuBiu~ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">ğŸ°BiuBiuBiu~</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">è®°å½•è‡ªå·±å­¦ä¹ çš„ç‚¹ç‚¹æ»´æ»´</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            å…¬ç›Š404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-26T19:34:26+08:00" content="2016-08-26">
              2016-08-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/" class="leancloud_visitors" data-flag-title="iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>æ­¤æ–‡æ˜¯<a href="http://objc.in/2016/08/24/iOS%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%EF%BC%9A%E9%87%8D%E6%B8%A9GCD%EF%BC%88%E4%B8%80%EF%BC%89/" target="_blank" rel="external">iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰</a>ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†ã€‚å°†ä¼šè¾…ä»¥ä¸€å®šçš„ä¾‹å­è®²è§£ä¸€äº›æ›´æ·±å±‚æ¬¡çš„<code>API</code>ä½¿ç”¨åŠæ³¨æ„äº‹é¡¹ã€‚</p>
<a id="more"></a>
<h2 id="æ …æ -Using-Barriers"><a href="#æ …æ -Using-Barriers" class="headerlink" title="æ …æ  | Using Barriers"></a>æ …æ  | Using Barriers</h2><h3 id="ä½¿ç”¨barrieræ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ"><a href="#ä½¿ç”¨barrieræ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ" class="headerlink" title="ä½¿ç”¨barrieræ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ"></a>ä½¿ç”¨<code>barrier</code>æ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ</h3><p>åœ¨<a href="http://objc.in/2016/08/24/iOS%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%EF%BC%9A%E9%87%8D%E6%B8%A9GCD%EF%BC%88%E4%B8%80%EF%BC%89/" target="_blank" rel="external">ä¸Šç¯‡æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»¬æœ€åæåˆ°äº†å¦‚ä½•åˆ©ç”¨<code>GCD</code>åˆ›å»ºçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ã€‚ä½†è¿™å…¶å®æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚è€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p>å¦‚æœæˆ‘ä»¬çš„å•ç²’ä¸­æœ‰è¿™æ ·çš„å¯å˜å±æ€§</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSMutableArray</span> *array;`</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬äº†è§£ï¼Œåœ¨<code>objc</code>ä¸­ï¼Œappleæ˜ç¡®å‘Šè¯‰æˆ‘ä»¬è¿™æ ·çš„å¯å˜é›†åˆéƒ½<strong>ä¸æ˜¯çº¿ç¨‹å®‰å…¨</strong>çš„ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬çš„å•ç²’åœ¨å¤šä¸ªçº¿ç¨‹ä¸­è¢«è¯»å†™ï¼Œå¾ˆå®¹æ˜“å°±å‘ç”Ÿæ•°æ®æ··ä¹±çš„é—®é¢˜ï¼</p>
<p><code>dispatch barrier</code>å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼</p>
<p>æ ¹æ®appleå®˜æ–¹æ–‡æ¡£ï¼š</p>
<blockquote>
<p>A dispatch barrier allows you to create a synchronization point within a concurrent dispatch queue. When it encounters a barrier, a concurrent queue delays the execution of the barrier block (or any further blocks) until all blocks submitted before the barrier finish executing. At that point, the barrier block executes by itself. Upon completion, the queue resumes its normal execution behavior.</p>
</blockquote>
<p>ç®€å•ç¿»è¯‘ä¸‹ï¼Œå¯è§<code>dispatch barrier</code>å…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—ä¸­åˆ›å»ºä¸€ä¸ª<strong>åŒæ­¥</strong>ç‚¹ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªä»»åŠ¡(<code>block</code>)ï¼Œå½“é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æŒ‰åºæ´¾å‘åˆ°è¿™é‡Œæ—¶ï¼Œå¹¶å‘é˜Ÿåˆ—ä¼šåœä¸‹ç­‰å¾…<code>barrier</code>ç‚¹å‰é¢çš„æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ¥ç€æ‰§è¡Œ<code>barrier block</code>ã€‚ç­‰<code>barrier block</code>æ‰§è¡Œå®Œæ¯•åç»§ç»­æ‰§è¡Œåé¢çš„ä»»åŠ¡:</p>
<p><img src="http://i2.buimg.com/572363/3af4576fb2897c06.png" alt="barrier"></p>
<p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åœ¨æ“ä½œè¿™ä¸ªæ•°ç»„ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨åŒæ—¶è¯»å–ï¼Œé‚£ä¸ä¼šå¼•èµ·é—®é¢˜ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹ä¸­åœ¨è¯»å–ï¼ŒåŒæ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­åœ¨å†™å…¥ï¼Œå°±ä¼šå¼•èµ·çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ï¼</p>
<p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¸æŠŠè¿™ä¸ªå±æ€§æš´éœ²åœ¨å¤–éƒ¨ï¼Œä½¿å¾—å¤–éƒ¨ä¸èƒ½ç›´æ¥å†™å…¥ï¼Œè€Œæ˜¯æä¾›ç»™å¤–éƒ¨ä¸€äº›æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)add:(<span class="keyword">id</span>)object;</div><div class="line">- (<span class="keyword">void</span>)remove:(<span class="keyword">id</span>)object;</div></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæˆ‘ä»¬åœ¨å†…éƒ¨åˆ©ç”¨<code>barrier</code>è¿›è¡Œå®‰å…¨çš„å†™å…¥ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)add:(<span class="keyword">id</span>)object&#123;</div><div class="line">	<span class="keyword">if</span>(!object) <span class="keyword">return</span>;</div><div class="line">	<span class="comment">//ä¿è¯å†™å…¥æ—¶ï¼Œä¸ä¼šè¢«é˜Ÿåˆ—ä¸­çš„å¼‚æ­¥æ“ä½œ"æ‰“æ‰°"</span></div><div class="line">	dispatch_barrier_async(<span class="keyword">self</span>.concurrentQueue, ^&#123; </div><div class="line">	[<span class="keyword">self</span>.array addObject:object];</div><div class="line">	</div><div class="line">	&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±ä¿è¯äº†åœ¨æ“ä½œå•ä¾‹ä¸­æ•°ç»„çš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šå‘ç”Ÿä»»ä½•å¼‚æ­¥è¡Œä¸ºï¼Œä¹Ÿå°±ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼</p>
<p>å¦å¤–éœ€è¦æ³¨æ„å¾—åœ°æ–¹æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä¸Šè¿°ä»£ç æ®µé‡Œä½¿ç”¨äº†<code>self.concurrentQueue</code>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šä½¿ç”¨<code>self.concurrentQueue</code>?</p>
<p>é¦–å…ˆè¦è¯´æ˜çš„æ˜¯ï¼Œ<code>self.concurrentQueue</code>æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å¹¶å‘é˜Ÿåˆ—ï¼Œå®ƒçš„åˆ›å»ºæ–¹å¼ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.concurrentQueue = dispatch_queue_create(<span class="string">"com.selander.GooglyPuff.photoQueue"</span>,</div><div class="line">                                                    DISPATCH_QUEUE_CONCURRENT);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¼šå°†å•ç²’ä¸­çš„è¯»æ“ä½œä¹Ÿæ”¾åœ¨è¿™ä¸ªé˜Ÿåˆ—é‡Œï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSArray</span> *) array</div><div class="line">&#123;</div><div class="line">    __block <span class="built_in">NSArray</span> *array; </div><div class="line">    <span class="built_in">dispatch_sync</span>(<span class="keyword">self</span>.concurrentQueue, ^&#123; </div><div class="line">        array = [<span class="built_in">NSArray</span> arrayWithArray:_photosArray]; </div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> array;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæ‰èƒ½ä¿è¯åœ¨å†™æ“ä½œæ—¶å€™æ‹¦ä½å‰é¢çš„è¯»æ“ä½œï¼Œå› ä¸ºå®ƒä»¬éƒ½åœ¨ç”¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚å½“ç„¶ï¼Œ<strong>è¿™ä¸ªåœ°æ–¹å¿…é¡»ä½¿ç”¨<code>dispathc_sync</code>å‡½æ•°</strong>ï¼Œå¦‚æœå¼‚æ­¥è°ƒç”¨æ„å‘³ç€å‡½æ•°ä¸ä¼šç«‹å³è¿”å›ã€‚é‚£ä¹ˆåœ¨å¤–éƒ¨ä½¿ç”¨çš„å¾—åˆ°çš„æ•°ç»„æ—¶å°±å¯èƒ½ä¼šå‡ºé—®é¢˜,æ¯”å¦‚:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSMutableArray</span> *)array&#123;</div><div class="line">    </div><div class="line">     __block <span class="built_in">NSMutableArray</span> *tmpArray = <span class="literal">nil</span>;</div><div class="line">    </div><div class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.concurrentQueue, ^&#123;</div><div class="line">        tmpArray = [_array <span class="keyword">copy</span>];<span class="comment">//æ³¨æ„è¿™ä¸ªåœ°æ–¹å¯èƒ½åœ¨è¿”å›ä¹‹å‰è¿˜æ²¡æœ‰è°ƒç”¨ï¼</span></div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> tmpArray;<span class="comment">//tmpArrayå¯èƒ½ä¸ºnilï¼</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="barrierçš„API"><a href="#barrierçš„API" class="headerlink" title="barrierçš„API"></a><code>barrier</code>çš„<code>API</code></h3><p><code>barrier</code>æ˜¯ä¸ªå¾ˆæœ‰ç”¨çš„ç‰¹æ€§ï¼Œåœ¨appleçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæœ‰åˆ—å‡ºäº†ä¸‹åˆ—å‡½æ•°ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> dispatch_barrier_async( <span class="built_in">dispatch_queue_t</span> queue, dispatch_block_t block);</div><div class="line"></div><div class="line"><span class="keyword">void</span> dispatch_barrier_async_f( <span class="built_in">dispatch_queue_t</span> queue, <span class="keyword">void</span>* context,dispatch_function_t work);</div><div class="line"></div><div class="line"><span class="keyword">void</span> dispatch_barrier_sync( <span class="built_in">dispatch_queue_t</span> queue, dispatch_block_t block);</div><div class="line"></div><div class="line"><span class="keyword">void</span> dispatch_barrier_sync_f( <span class="built_in">dispatch_queue_t</span> queue, <span class="keyword">void</span>* context, dispatch_function_t work);</div></pre></td></tr></table></figure>
<p>å…¶å®è¿˜æ˜¯å¾ˆæœ‰è§„å¾‹çš„ğŸ˜„ï¼š<code>async</code>ä¸<code>sync</code>ç›¸å¯¹è¡¨ç¤ºåŒæ­¥orå¼‚æ­¥ã€<code>async_f</code>ä¸<code>sync</code>ç›¸å¯¹è¡¨ç¤ºæ‰§è¡Œçš„æ˜¯<code>block</code>æˆ–è€…<code>dispatch_function_t</code>å¯¹è±¡ã€‚</p>
<p>ç”±äºç¯‡å¹…æœ‰é™ï¼Œåœ¨è¿™é‡Œå°±ä¸åœ¨è§£é‡Šäº†ã€‚åªç»™å‡ºç»“è®º: </p>
<ol>
<li><p>æ— è®ºæ˜¯<code>dispatch_barrier_sync</code>or <code>dispatch_barrier_async</code>å‡½æ•°ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ°<code>dispatch_barrier_sync_f</code>or<code>dispatch_barrier_async_f</code>ã€‚</p>
</li>
<li><p><code>dispatch_barrier_sync_f</code>å‡½æ•°ä¸­çš„<code>void* context</code>å‚æ•°å…¶å®å°±æ˜¯æˆ‘ä»¬ä¼ ç»™<code>dispatch_barrier_sync</code>å‡½æ•°ä¸­çš„<code>block</code>å¯¹è±¡ã€‚è€Œ<code>dispatch_function_t work</code>å‚æ•°æ˜¯<code>block</code>å¯¹è±¡é‡Œçš„å‡½æ•°æŒ‡é’ˆ(æ‡‚çš„äººè‡ªç„¶æ‡‚ğŸ˜„)ã€‚</p>
</li>
</ol>
<h3 id="barrierä½¿ç”¨å»ºè®®"><a href="#barrierä½¿ç”¨å»ºè®®" class="headerlink" title="barrierä½¿ç”¨å»ºè®®"></a><code>barrier</code>ä½¿ç”¨å»ºè®®</h3><p>è¦ç†è§£<code>barrier</code>æ‹¦ä½çš„æ˜¯é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>barrier</code>é’ˆå¯¹çš„é˜Ÿåˆ—ã€‚æ‰€ä»¥ä¸éš¾ç»™å‡ºä»¥ä¸‹å»ºè®®ï¼š</p>
<ol>
<li>ä¸è¦åœ¨è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—ä¸­ä½¿ç”¨ï¼šä¸€ä¸ªå¾ˆåçš„é€‰æ‹©ï¼Œéšœç¢ä¸ä¼šæœ‰ä»»ä½•å¸®åŠ©ï¼Œå› ä¸ºä¸ç®¡æ€æ ·ï¼Œä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸€æ¬¡éƒ½åªæ‰§è¡Œä¸€ä¸ªæ“ä½œã€‚</li>
<li>ä¸è¦åœ¨å…¨å±€å¹¶å‘é˜Ÿåˆ—ä¸­ä½¿ç”¨ï¼šè¦å°å¿ƒï¼Œè¿™å¯èƒ½ä¸æ˜¯æœ€å¥½çš„ä¸»æ„ï¼Œå› ä¸ºå…¶å®ƒç³»ç»Ÿå¯èƒ½åœ¨ä½¿ç”¨é˜Ÿåˆ—è€Œä¸”ä½ ä¸èƒ½å„æ–­å®ƒä»¬åªä¸ºä½ è‡ªå·±çš„ç›®çš„ã€‚</li>
<li>æœ€å¥½åœ¨è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ä¸­ä½¿ç”¨ï¼šè¿™å¯¹äºåŸå­æˆ–ä¸´ç•ŒåŒºä»£ç æ¥è¯´æ˜¯æä½³çš„é€‰æ‹©ã€‚ä»»ä½•ä½ åœ¨è®¾ç½®æˆ–å®ä¾‹åŒ–çš„éœ€è¦çº¿ç¨‹å®‰å…¨çš„äº‹ç‰©éƒ½æ˜¯ä½¿ç”¨éšœç¢çš„æœ€ä½³å€™é€‰ã€‚</li>
</ol>
<h3 id="barrieréƒ¨åˆ†å°ç»“"><a href="#barrieréƒ¨åˆ†å°ç»“" class="headerlink" title="barrieréƒ¨åˆ†å°ç»“"></a><code>barrier</code>éƒ¨åˆ†å°ç»“</h3><p><strong>todo è¿™é‡Œä¹‹åç»™å‡ºæºç è§£è¯»æ–‡ç« åœ°å€</strong>å¦‚æœæƒ³è¦äº†è§£æ›´å¤šå…³äº<code>barrier</code>çš„å®ç°ç»†èŠ‚ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå·±ä¸‹è½½<code>GCD</code>æºç é˜…è¯»ï¼š<a href="http://opensource.apple.com/tarballs/libdispatch/libdispatch-442.1.4.tar.gz" target="_blank" rel="external">libdispatch</a>ã€‚</p>
<h2 id="è°ƒåº¦ç»„-Dispatch-Groups"><a href="#è°ƒåº¦ç»„-Dispatch-Groups" class="headerlink" title="è°ƒåº¦ç»„ | Dispatch Groups"></a>è°ƒåº¦ç»„ | Dispatch Groups</h2><h3 id="ä½¿ç”¨Dispatch-Groupsé€šçŸ¥æ‰€æœ‰ä»»åŠ¡å·²ç»å®Œæˆ"><a href="#ä½¿ç”¨Dispatch-Groupsé€šçŸ¥æ‰€æœ‰ä»»åŠ¡å·²ç»å®Œæˆ" class="headerlink" title="ä½¿ç”¨Dispatch Groupsé€šçŸ¥æ‰€æœ‰ä»»åŠ¡å·²ç»å®Œæˆ"></a>ä½¿ç”¨Dispatch Groupsé€šçŸ¥æ‰€æœ‰ä»»åŠ¡å·²ç»å®Œæˆ</h3><p>ä¸ä¸Šæ–‡ä¸€æ ·ï¼Œæˆ‘ä»¬ä¼šä»¥ä¸€ä¸ªä¾‹å­å¼€å§‹æ¥ä»‹ç»<code>Dispatch Groups</code>çš„éƒ¨åˆ†ï¼š</p>
<p>å‡è®¾ä½ è¦ä»ç½‘ä¸Šä¸‹è½½è®¸å¤šå¼ å›¾ç‰‡ï¼Œå®Œæˆä¹‹åæŠŠå®ƒä»¬ç»„åˆåœ¨ä¸€èµ·æ„æˆæ–°çš„å›¾åƒã€‚ä¹Ÿå°±æ˜¯è¯´ä½ å¿…é¡»æŠŠæ‰€æœ‰å›¾ç‰‡ä¸‹è½½å®Œæˆåå†ç»Ÿä¸€æ˜¾ç¤º:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad&#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> (^block1)() = ^&#123;</div><div class="line">        <span class="comment">//download img_1 from network...</span></div><div class="line">    </div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">void</span> (^block2)() = ^&#123;</div><div class="line">        <span class="comment">//download img_2 from network...</span></div><div class="line"></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">void</span> (^block3)() = ^&#123;</div><div class="line">        <span class="comment">//download img_2 from network...</span></div><div class="line"></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>), block1);</div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>), block2);</div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>), block3);</div><div class="line">    </div><div class="line">    <span class="comment">//æ‹¼æ¥å›¾ç‰‡</span></div><div class="line">    [<span class="keyword">self</span> finishImg];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>è¿™æ ·å†™æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ï¼</strong><code>block1,block2,block3</code>çš„è¿è¡Œç”±äºæ˜¯åœ¨åå°ï¼Œæˆ‘ä»¬æ— æ³•ç¡®ä¿æ‹¼æ¥å›¾ç‰‡æ—¶æ‰€æœ‰å›¾ç‰‡å·²ç»ä¸‹è½½å®Œæˆã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œ<code>Dispatch Groups</code>å°±æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼š</p>
<h4 id="æ–¹æ³•ä¸€ï¼šä½¿ç”¨dispatch-group-notify"><a href="#æ–¹æ³•ä¸€ï¼šä½¿ç”¨dispatch-group-notify" class="headerlink" title="æ–¹æ³•ä¸€ï¼šä½¿ç”¨dispatch_group_notify"></a>æ–¹æ³•ä¸€ï¼šä½¿ç”¨<code>dispatch_group_notify</code></h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad&#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> (^block1)() = ^&#123;</div><div class="line">        <span class="comment">//download img1 from network...</span></div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"block1 finish"</span>);</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> (^block2)() = ^&#123;</div><div class="line">        <span class="comment">//download img2 from network...</span></div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"block2 finish"</span>);</div><div class="line">   &#125;;</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> (^block3)() = ^&#123;</div><div class="line">        <span class="comment">//download img3 from network...</span></div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"block3 finish"</span>);</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>);</div><div class="line">    </div><div class="line">    dispatch_group_t downloadGroup = dispatch_group_create();</div><div class="line">    </div><div class="line">    dispatch_group_async(downloadGroup, queue, block1);</div><div class="line">    dispatch_group_async(downloadGroup, queue, block2);</div><div class="line">    dispatch_group_async(downloadGroup, queue, block3);</div><div class="line">    </div><div class="line">    dispatch_group_notify(downloadGroup, queue, ^&#123;</div><div class="line">        [<span class="keyword">self</span> finishImg];</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)finishImg&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"finishi.."</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œ<code>finishImg</code>æ–¹æ³•å°±ä¼šåœ¨ä¸‰ä¸ªblockå…¨éƒ¨æ‰§è¡Œå®Œæ¯•åæ‰è¢«è°ƒç”¨:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">2016-08-27 15:12:37.885 æ€»ç»“æµ‹è¯•[91285:7916599] block3 finish</div><div class="line">2016-08-27 15:12:37.885 æ€»ç»“æµ‹è¯•[91285:7916593] block2 finish</div><div class="line">2016-08-27 15:12:37.885 æ€»ç»“æµ‹è¯•[91285:7916604] block1 finish</div><div class="line">2016-08-27 15:12:37.886 æ€»ç»“æµ‹è¯•[91285:7916604] finishi..</div></pre></td></tr></table></figure>
<p><code>dispatch_group_notify</code>å‡½æ•°éå¸¸çµæ´»ï¼Œå®ƒå…è®¸ä½ åœ¨<code>group</code>å†…çš„ä»»åŠ¡å…¨éƒ¨å®Œæˆåä¼ é€’ä¸€ä¸ª<code>block</code>ä½œä¸ºå›è°ƒã€‚åœ¨ä¸Šè¿°çš„æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å°†å›¾ç‰‡æ‹¼æ¥æ–¹æ³•ä½œä¸ºå›è°ƒã€‚</p>
<p>é™¤äº†<code>dispatch_group_notify</code>å‡½æ•°ï¼Œè¿˜æœ‰ä¸ª<code>dispatch_group_t</code>å­—çœ¼ä½ å¯èƒ½ä¼šæ„Ÿåˆ°é™Œç”Ÿï¼Œåœ¨è‹¹æœçš„å®˜æ–¹æ–‡æ¡£ä¸­:</p>
<blockquote>
<p>A group of block objects submitted to a queue for asynchronous invocation.</p>
</blockquote>
<p><strong>Declaration</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> dispatch_group_s *dispatch_group_t;</div></pre></td></tr></table></figure>
<p><strong>Discussion</strong></p>
<blockquote>
<p>A dispatch group is a mechanism for monitoring a set of blocks. Your application can monitor the blocks in the group synchronously or asynchronously depending on your needs. By extension, a group can be useful for synchronizing for code that depends on the completion of other tasks.</p>
<p>Note that the blocks in a group may be run on different queues, and each individual block can add more blocks to the group.</p>
<p>The dispatch group keeps track of how many blocks are outstanding, and GCD retains the group until all its associated blocks complete execution.</p>
</blockquote>
<p>å¯è§<code>group</code>æ˜¯å¼‚æ­¥<code>block</code>çš„é›†åˆã€‚è€Œ<code>dispatch group</code>æ˜¯ä¸€ç§ç›‘å¬è¿™ç§é›†åˆçš„æœºåˆ¶ã€‚è‹¹æœå…è®¸æˆ‘ä»¬åœ¨åŒæ­¥æˆ–è€…å¼‚æ­¥çš„ç›‘å¬é›†åˆé‡Œçš„<code>block</code>å®Œæˆçš„æƒ…å†µï¼Œè€Œä¸”éœ€è¦æ³¨æ„åˆ°æ˜¯ï¼Œ<code>group</code>å†…çš„<code>block</code>å¯èƒ½æ˜¯åœ¨ä»»ä½•é˜Ÿåˆ—é‡Œçš„ã€‚å°±åƒæˆ‘ä»¬ä¸Šé¢çš„ä»£ç ä¸­å†™çš„é‚£æ ·:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dispatch_group_async(downloadGroup, queue, block1);</div><div class="line">dispatch_group_async(downloadGroup, queue, block2);</div><div class="line">dispatch_group_async(downloadGroup, queue, block3);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥æäº¤<code>group</code>å†…çš„ä»»åŠ¡åˆ°ä»»ä½•<code>queue</code>å†…ã€‚</p>
<p>é¡ºå¸¦ä¸€æçš„æ˜¯ï¼Œ<code>gcd</code>ä¼šå¼•ç”¨<code>group</code>å¯¹è±¡ç›´åˆ°ä»»åŠ¡éƒ½å®Œæˆã€‚</p>
<h4 id="æ–¹æ³•äºŒï¼šä½¿ç”¨dispatch-group-wait"><a href="#æ–¹æ³•äºŒï¼šä½¿ç”¨dispatch-group-wait" class="headerlink" title="æ–¹æ³•äºŒï¼šä½¿ç”¨dispatch_group_wait"></a>æ–¹æ³•äºŒï¼šä½¿ç”¨<code>dispatch_group_wait</code></h4><p><code>dispatch_group_wait</code>å‡½æ•°å°±åƒå®ƒçš„åå­—æ‰€å™è¿°çš„é‚£æ ·ï¼š<strong>ç­‰å¾…</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">long</span> dispatch_group_wait(dispatch_group_t group, dispatch_time_t timeout);</div></pre></td></tr></table></figure>
<p><code>dispatch_group_wait</code>å‡½æ•°ä¼šç­‰å¾…ç›´åˆ°æŒ‡å®šçš„<code>group</code>å†…çš„ä»»åŠ¡å…¨éƒ¨å®Œæˆæˆ–è€…è¶…æ—¶,ä»ä¸Šæ–¹çš„ç”³æ˜æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<code>dispatch_group_wait</code>ä¸<code>dispatch_group_wait</code>å‡½æ•°ä¸€æ ·éƒ½éœ€è¦ä¸€ä¸ª<code>group</code>å‚æ•°ï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ª<code>timeout</code>æ›¿ä»£<code>block</code>å›è°ƒã€‚åŒæ—¶ï¼Œå®ƒè¿˜ä¼šæœ‰ä¸€ä¸ª<code>long</code>å‹è¿”å›å€¼ã€‚è¿™ä¸ªè¿”å›æ—¶æ ‡å¿—äº†å½“å‰ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µæˆ–è€…æ˜¯å¦è¶…æ—¶ï¼š</p>
<blockquote>
<p><code>dispatch_group_wait</code> ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°ä»»åŠ¡å…¨éƒ¨å®Œæˆæˆ–è€…è¶…æ—¶ã€‚å¦‚æœåœ¨æ‰€æœ‰ä»»åŠ¡å®Œæˆå‰è¶…æ—¶äº†ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéé›¶å€¼ã€‚ä½ å¯ä»¥å¯¹æ­¤è¿”å›å€¼åšæ¡ä»¶åˆ¤æ–­ä»¥ç¡®å®šæ˜¯å¦è¶…å‡ºç­‰å¾…å‘¨æœŸ;å½“ç„¶ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œç”¨ <code>DISPATCH_TIME_FOREVER</code> è®©å®ƒæ°¸è¿œç­‰å¾…ã€‚å®ƒçš„æ„æ€ï¼Œå‹¿åº¸ç½®ç–‘å°±æ˜¯ï¼Œæ°¸ï¼è¿œï¼ç­‰ï¼å¾…ï¼äºæ˜¯æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­è¿”å›å€¼æ˜¯å¦ä¸º0å°±å¯ä»¥çŸ¥é“å½“å‰ä»»åŠ¡æ˜¯å¦å®Œæˆäº†ã€‚</p>
</blockquote>
<p>æ³¨æ„ï¼Œä¸€å®šè¦ç†è§£å¥½<strong>ç­‰å¾…</strong>ã€‚è¿™æ„å‘³ç€<code>dispatch_group_wait</code>ä¼š<strong>é˜»å¡å½“å‰çº¿ç¨‹</strong>ï¼å¦å¤–ï¼Œå¦‚æœä½ ä¸ä½¿ç”¨<code>DISPATCH_TIME_FOREVER</code>å‚æ•°è€Œæ˜¯ç”¨<code>DISPATCH_TIME_NOW</code>ï¼Œè¯¥å‡½æ•°ä¼šç«‹å³è¿”å›ä¸€ä¸ªå€¼ç»™ä½ ï¼Œå«ä¹‰ä¸<code>DISPATCH_TIME_FOREVER</code>ä¸€æ ·ã€‚å½“ç„¶äº†ï¼Œè¿™æ ·çš„è¯å°±ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹äº†ã€‚ä½†æ˜¯éœ€è¦åƒä¸»çº¿ç¨‹é‡Œçš„<code>NSRunLoop</code>é‚£æ ·ä¸åœå¾ªç¯æ£€æµ‹å½“å‰ä»»åŠ¡æ˜¯å¦å…¨éƒ¨å®Œæˆã€‚</p>
<p>äº†è§£äº†<code>dispatch_group_wait</code>å‡½æ•°çš„å«ä¹‰ï¼Œæˆ‘ä»¬ä¸éš¾å°†ç¬¬ä¸€ç§æ–¹æ³•é‡Œçš„ä»£ç æ”¹å†™ä¸ºï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad&#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> grayColor];</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> (^block1)() = ^&#123;</div><div class="line">        <span class="comment">//download img1 from network...</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">500</span>;  i ++) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"block1 finish  %d"</span>,i);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> (^block2)() = ^&#123;</div><div class="line">        <span class="comment">//download img2 from network...</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">500</span>;  i ++) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"block2 finish  %d"</span>,i);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> (^block3)() = ^&#123;</div><div class="line">        <span class="comment">//download img3 from network...</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">500</span>;  i ++) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"block3 finish  %d"</span>,i);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>);</div><div class="line">    </div><div class="line">    dispatch_group_t downloadGroup = dispatch_group_create();</div><div class="line">    </div><div class="line">    dispatch_group_async(downloadGroup, queue, block1);</div><div class="line">    dispatch_group_async(downloadGroup, queue, block2);</div><div class="line">    dispatch_group_async(downloadGroup, queue, block3);</div><div class="line">    </div><div class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">        <span class="keyword">long</span> result =  dispatch_group_wait(downloadGroup, DISPATCH_TIME_FOREVER);</div><div class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">                [<span class="keyword">self</span> finishImg];</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>éœ€è¦æ ¼å¤–æ³¨æ„çš„æ˜¯ï¼šç”±äº<code>dispatch_group_wait</code>å‡½æ•°ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†<code>dispatch_async</code>å‡½æ•°ä»¥ä¾¿èƒ½æ›´å¿«çš„ä½¿<code>viewDidLoad</code>æ–¹æ³•ç»“æŸä»¥ç»™äºˆç”¨æˆ·æ›´å¥½çš„ä½“éªŒã€‚</p>
<h2 id="å¹¶è¡Œè¿è¡Œçš„forå¾ªç¯ï¼šdispatch-apply"><a href="#å¹¶è¡Œè¿è¡Œçš„forå¾ªç¯ï¼šdispatch-apply" class="headerlink" title="å¹¶è¡Œè¿è¡Œçš„forå¾ªç¯ï¼šdispatch_apply"></a>å¹¶è¡Œè¿è¡Œçš„<code>for</code>å¾ªç¯ï¼š<code>dispatch_apply</code></h2><p><code>dispatch_apply</code>å‡½æ•°ä¼šå°†<code>block</code>æŒ‰æŒ‡å®šçš„æ¬¡æ•°æäº¤åˆ°æŒ‡å®šçš„é˜Ÿåˆ—é‡Œå»ï¼Œä¹‹åç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆåè¿”å›ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad&#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>);</div><div class="line"></div><div class="line">    dispatch_apply(<span class="number">10</span>, queue, ^(size_t x) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%zu current thead == %@"</span>, x , [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"finishi!"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š<br><img src="http://i2.buimg.com/572363/a0cc83549bcc31a1.png" alt="Markdown"></p>
<p>æœ‰è¶£çš„ä¿¡æ¯å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªä»»åŠ¡å®Œæˆçš„é¡ºåºå¹¶ä¸ä¸€å®šï¼Œè€Œä¸”æ‰€åœ¨çš„çº¿ç¨‹ä¹Ÿä¸ä¸€å®šã€‚(<code>number</code>ä¸ä¸º1çš„è¯éƒ½æ˜¯å­çº¿ç¨‹)åœ¨æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåï¼Œæ‰ä¼šæ‰“å°<code>finish</code>ã€‚</p>
<p>è¿™æ˜¯å› ä¸º<code>dispatch_apply</code>å‡½æ•°ä¼šé˜»å¡ä½å½“å‰çº¿ç¨‹ï¼Œè¿™å’Œ<code>dispatch_sync</code>æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥æ¨èåœ¨<code>dispath_async</code>å‡½æ•°ä¸­å¼‚æ­¥åœ°æ‰§è¡Œ<code>dispatch_apply</code>å‡½æ•°ã€‚å½“ç„¶äº†ï¼Œå…³äºé˜Ÿåˆ—çš„é€‰æ‹©ä¸Šè‚¯å®šä¹Ÿè¦æ˜¯å¹¶å‘é˜Ÿåˆ—ï¼Œå¦åˆ™æ²¡æœ‰ä»»ä½•æ„ä¹‰:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad&#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>);</div><div class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">        dispatch_apply(<span class="number">10</span>, queue, ^(size_t x) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%zu current thead == %@"</span>, x , [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">        &#125;);</div><div class="line">        </div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"finish %@"</span>,[<span class="built_in">NSThread</span> currentThread]);</div><div class="line"></div><div class="line">        &#125;);</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œåœ¨<a href="https://www.raywenderlich.com/63338/grand-central-dispatch-in-depth-part-2" target="_blank" rel="external">è¿™ç¯‡æ–‡ç« </a>ä¸­ä½œè€…ä¹Ÿæåˆ°äº†ï¼šä½¿ç”¨<code>dispatch_apply</code>å‡½æ•°å¼€è¾Ÿçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡å¯èƒ½è¦æ¯”<code>for</code>å¾ªç¯ä»£ä»·å¤§å¾—å¤šï¼Œæ‰€ä»¥ä½¿ç”¨å‰è¦ä¸‰æ€ã€‚</p>
<h2 id="ä¿¡å·é‡-Semaphore"><a href="#ä¿¡å·é‡-Semaphore" class="headerlink" title="ä¿¡å·é‡ | Semaphore"></a>ä¿¡å·é‡ | Semaphore</h2><h3 id="æœ‰è¶£çš„å“²å­¦å®¶é—®é¢˜"><a href="#æœ‰è¶£çš„å“²å­¦å®¶é—®é¢˜" class="headerlink" title="æœ‰è¶£çš„å“²å­¦å®¶é—®é¢˜"></a>æœ‰è¶£çš„å“²å­¦å®¶é—®é¢˜</h3><p>åœ¨äº†è§£ä¿¡å·é‡ä¹‹å‰ï¼Œå¯ä»¥å…ˆçœ‹çœ‹è¿™ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼š<a href="https://zh.wikipedia.org/wiki/%E5%93%B2%E5%AD%A6%E5%AE%B6%E5%B0%B1%E9%A4%90%E9%97%AE%E9%A2%98" target="_blank" rel="external">å“²å­¦å®¶å°±é¤é—®é¢˜</a>ã€‚</p>
<p>ä»¥ä¸‹æ‘˜è‡ªç»´åŸºç™¾ç§‘ï¼š</p>
<blockquote>
<p>ä¿¡å·é‡ï¼ˆè‹±è¯­ï¼šSemaphoreï¼‰åˆç§°ä¸ºä¿¡å·é‡ã€æ——è¯­ï¼Œå®ƒä»¥ä¸€ä¸ªæ•´æ•°å˜é‡ï¼Œæä¾›ä¿¡å·ï¼Œä»¥ç¡®ä¿åœ¨å¹¶è¡Œè®¡ç®—ç¯å¢ƒä¸­ï¼Œä¸åŒè¿›ç¨‹åœ¨è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œä¸ä¼šå‘ç”Ÿå†²çªã€‚æ˜¯ä¸€ç§ä¸éœ€è¦ä½¿ç”¨å¿™ç¢Œç­‰å¾…ï¼ˆbusy waitingï¼‰çš„ä¸€ç§æ–¹æ³•ã€‚</p>
<p>ä¿¡å·é‡çš„æ¦‚å¿µæ˜¯ç”±è·å…°è®¡ç®—æœºç§‘å­¦å®¶è‰¾å…¹æ ¼Â·è¿ªæ°æ–¯ç‰¹æ‹‰ï¼ˆEdsger W. Dijkstraï¼‰å‘æ˜çš„ï¼Œå¹¿æ³›çš„åº”ç”¨äºä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œç»™äºˆæ¯ä¸€ä¸ªè¿›ç¨‹ä¸€ä¸ªä¿¡å·é‡ï¼Œä»£è¡¨æ¯ä¸ªè¿›ç¨‹ç›®å‰çš„çŠ¶æ€ï¼Œæœªå¾—åˆ°æ§åˆ¶æƒçš„è¿›ç¨‹ä¼šåœ¨ç‰¹å®šåœ°æ–¹è¢«å¼ºè¿«åœä¸‹æ¥ï¼Œç­‰å¾…å¯ä»¥ç»§ç»­è¿›è¡Œçš„ä¿¡å·åˆ°æ¥ã€‚å¦‚æœä¿¡å·é‡æ˜¯ä¸€ä¸ªä»»æ„çš„æ•´æ•°ï¼Œé€šå¸¸è¢«ç§°ä¸ºè®¡æ•°ä¿¡å·é‡ï¼ˆCounting semaphoreï¼‰ï¼Œæˆ–ä¸€èˆ¬ä¿¡å·é‡ï¼ˆgeneral semaphoreï¼‰ï¼›å¦‚æœä¿¡å·é‡åªæœ‰äºŒè¿›åˆ¶çš„0æˆ–1ï¼Œç§°ä¸ºäºŒè¿›åˆ¶ä¿¡å·é‡ï¼ˆbinary semaphoreï¼‰ã€‚åœ¨linuxç³»ä¸­ï¼ŒäºŒè¿›åˆ¶ä¿¡å·é‡ï¼ˆbinary semaphoreï¼‰åˆç§°Mutexã€‚</p>
</blockquote>
<h3 id="ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­"><a href="#ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­"></a>ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­</h3><p>å›åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œåœ¨ä¸Šä¸€ç¯‡<a href="http://objc.in/2016/08/24/iOS%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%EF%BC%9A%E9%87%8D%E6%B8%A9GCD%EF%BC%88%E4%B8%80%EF%BC%89/" target="_blank" rel="external">iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰</a>ä¸­æˆ‘æ›¾ä»‹ç»è¿‡ï¼š<code>NSMutableArray</code>ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥ä»¥ä¸‹çš„å†™æ³•ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad&#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    <span class="built_in">NSMutableArray</span> *array  = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">    </div><div class="line">    _array = array;</div><div class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">100</span>;  i ++) &#123;</div><div class="line">        <span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">                [_array addObject:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d"</span>,i]];</div><div class="line">                </div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥è¯•è¯•è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå¾ˆå®¹æ˜“å¼•å‘crashã€‚æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ Dispatch Semaphore æ¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 id="åˆ©ç”¨-Dispatch-Semaphore-æ¥è§£å†³"><a href="#åˆ©ç”¨-Dispatch-Semaphore-æ¥è§£å†³" class="headerlink" title="åˆ©ç”¨ Dispatch Semaphore æ¥è§£å†³"></a>åˆ©ç”¨ Dispatch Semaphore æ¥è§£å†³</h3><p>æ‘˜è‡ªï¼š<strong>ã€Šobjcé«˜çº§ç¼–ç¨‹ï¼šiOS ä¸ OS X å¤šçº¿ç¨‹ä¸å†…å­˜ç®¡ç†ã€‹</strong>ï¼š</p>
<blockquote>
<p>Dispatch Semaphore æ˜¯æŒæœ‰è®¡æ•°çš„ä¿¡å·ï¼Œè¯¥è®¡æ•°æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„è®¡æ•°ç±»å‹ä¿¡å·ã€‚æ‰€è°“ä¿¡å·ï¼Œæ˜¯ç±»ä¼¼äºè¿‡é©¬è·¯æ—¶å¸¸ç”¨çš„æ‰‹æ——ï¼Œå¯ä»¥é€šè¿‡æ—¶ä¸¾èµ·æ‰‹æ——ï¼Œä¸å¯é€šè¿‡æ—¶æ”¾ä¸‹æ‰‹æ——ã€‚è€Œåœ¨ Dispatch Semaphore ä¸­ï¼Œä½¿ç”¨è®¡æ•°æ¥å®ç°æ­¤åŠŸèƒ½ã€‚è®¡æ•°ä¸º0æ—¶ç­‰å¾…ï¼Œè®¡æ•°ä¸º1æˆ–è€…å¤§äº1æ—¶ï¼Œå‡å»1è€Œä¸ç­‰å¾…ã€‚</p>
</blockquote>
<p>### </p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>è¯·æ¯å’–å•¡å–ï¼Ÿ</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>èµ</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://i1.buimg.com/572363/b21593e5f65ea204.jpg" alt="Zheng Li WeChat Pay"/>
          <p>å¾®ä¿¡æ‰“èµ</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="http://i1.buimg.com/572363/7caac38df4844f66.jpg" alt="Zheng Li Alipay"/>
          <p>æ”¯ä»˜å®æ‰“èµ</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/08/24/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰/" rel="next" title="iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰">
                <i class="fa fa-chevron-left"></i> iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/08/27/IP-TCPå’ŒHTTP/" rel="prev" title=" [é¢è¯•] IP , TCP å’Œ HTTP ">
                 [é¢è¯•] IP , TCP å’Œ HTTP  <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/"
           data-title="iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰" data-url="http://yoursite.com/2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://tva3.sinaimg.cn/crop.0.0.511.511.180/006pqpL6jw8f4z97xky5nj30e70e8aai.jpg"
               alt="Zheng Li" />
          <p class="site-author-name" itemprop="name">Zheng Li</p>
          <p class="site-description motion-element" itemprop="description">iOSå¼€å‘èœé¸¡ï¼ŒåŠªåŠ›æé«˜è‡ªæˆ‘ä¸­ã€‚</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">7</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://yulingtianxia.com/" title="yulingtianxia" target="_blank">yulingtianxia</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://kyxu.tech/" title="kyXu" target="_blank">kyXu</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å¼•è¨€"><span class="nav-number">1.</span> <span class="nav-text">å¼•è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ …æ -Using-Barriers"><span class="nav-number">2.</span> <span class="nav-text">æ …æ  | Using Barriers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨barrieræ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ"><span class="nav-number">2.1.</span> <span class="nav-text">ä½¿ç”¨barrieræ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#barrierçš„API"><span class="nav-number">2.2.</span> <span class="nav-text">barrierçš„API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#barrierä½¿ç”¨å»ºè®®"><span class="nav-number">2.3.</span> <span class="nav-text">barrierä½¿ç”¨å»ºè®®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#barrieréƒ¨åˆ†å°ç»“"><span class="nav-number">2.4.</span> <span class="nav-text">barrieréƒ¨åˆ†å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è°ƒåº¦ç»„-Dispatch-Groups"><span class="nav-number">3.</span> <span class="nav-text">è°ƒåº¦ç»„ | Dispatch Groups</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨Dispatch-Groupsé€šçŸ¥æ‰€æœ‰ä»»åŠ¡å·²ç»å®Œæˆ"><span class="nav-number">3.1.</span> <span class="nav-text">ä½¿ç”¨Dispatch Groupsé€šçŸ¥æ‰€æœ‰ä»»åŠ¡å·²ç»å®Œæˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ–¹æ³•ä¸€ï¼šä½¿ç”¨dispatch-group-notify"><span class="nav-number">3.1.1.</span> <span class="nav-text">æ–¹æ³•ä¸€ï¼šä½¿ç”¨dispatch_group_notify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ–¹æ³•äºŒï¼šä½¿ç”¨dispatch-group-wait"><span class="nav-number">3.1.2.</span> <span class="nav-text">æ–¹æ³•äºŒï¼šä½¿ç”¨dispatch_group_wait</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¹¶è¡Œè¿è¡Œçš„forå¾ªç¯ï¼šdispatch-apply"><span class="nav-number">4.</span> <span class="nav-text">å¹¶è¡Œè¿è¡Œçš„forå¾ªç¯ï¼šdispatch_apply</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¿¡å·é‡-Semaphore"><span class="nav-number">5.</span> <span class="nav-text">ä¿¡å·é‡ | Semaphore</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æœ‰è¶£çš„å“²å­¦å®¶é—®é¢˜"><span class="nav-number">5.1.</span> <span class="nav-text">æœ‰è¶£çš„å“²å­¦å®¶é—®é¢˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­"><span class="nav-number">5.2.</span> <span class="nav-text">ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ©ç”¨-Dispatch-Semaphore-æ¥è§£å†³"><span class="nav-number">5.3.</span> <span class="nav-text">åˆ©ç”¨ Dispatch Semaphore æ¥è§£å†³</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zheng Li</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"BJTUzhengli"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("28Bi52ufQCnrlpfv4vbx8JEG-gzGzoHsz", "1cAbB9JCSijqEURfv3Pa9uYd");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
