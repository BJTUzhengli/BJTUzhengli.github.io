<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="å¼•è¨€æ­¤æ–‡æ˜¯iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰çš„ç¬¬äºŒéƒ¨åˆ†ã€‚å°†ä¼šè¾…ä»¥ä¸€å®šçš„ä¾‹å­è®²è§£ä¸€äº›æ›´æ·±å±‚æ¬¡çš„APIä½¿ç”¨åŠæ³¨æ„äº‹é¡¹ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰.md">
<meta property="og:url" content="http://yoursite.com/2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/index.html">
<meta property="og:site_name" content="ğŸ°BiuBiuBiu~">
<meta property="og:description" content="å¼•è¨€æ­¤æ–‡æ˜¯iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰çš„ç¬¬äºŒéƒ¨åˆ†ã€‚å°†ä¼šè¾…ä»¥ä¸€å®šçš„ä¾‹å­è®²è§£ä¸€äº›æ›´æ·±å±‚æ¬¡çš„APIä½¿ç”¨åŠæ³¨æ„äº‹é¡¹ã€‚">
<meta property="og:image" content="http://i2.buimg.com/572363/3af4576fb2897c06.png">
<meta property="og:updated_time" content="2016-08-26T11:35:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰.md">
<meta name="twitter:description" content="å¼•è¨€æ­¤æ–‡æ˜¯iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰çš„ç¬¬äºŒéƒ¨åˆ†ã€‚å°†ä¼šè¾…ä»¥ä¸€å®šçš„ä¾‹å­è®²è§£ä¸€äº›æ›´æ·±å±‚æ¬¡çš„APIä½¿ç”¨åŠæ³¨æ„äº‹é¡¹ã€‚">
<meta name="twitter:image" content="http://i2.buimg.com/572363/3af4576fb2897c06.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Zheng Li'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/"/>

  <title> iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰.md | ğŸ°BiuBiuBiu~ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">ğŸ°BiuBiuBiu~</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">è®°å½•è‡ªå·±å­¦ä¹ çš„ç‚¹ç‚¹æ»´æ»´</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            å…¬ç›Š404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰.md
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-26T19:34:26+08:00" content="2016-08-26">
              2016-08-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/" class="leancloud_visitors" data-flag-title="iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰.md">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>æ­¤æ–‡æ˜¯<a href="http://objc.in/2016/08/24/iOS%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%EF%BC%9A%E9%87%8D%E6%B8%A9GCD%EF%BC%88%E4%B8%80%EF%BC%89/" target="_blank" rel="external">iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰</a>çš„ç¬¬äºŒéƒ¨åˆ†ã€‚å°†ä¼šè¾…ä»¥ä¸€å®šçš„ä¾‹å­è®²è§£ä¸€äº›æ›´æ·±å±‚æ¬¡çš„<code>API</code>ä½¿ç”¨åŠæ³¨æ„äº‹é¡¹ã€‚</p>
<a id="more"></a>
<h2 id="æ …æ -Using-Barriers"><a href="#æ …æ -Using-Barriers" class="headerlink" title="æ …æ  | Using Barriers"></a>æ …æ  | Using Barriers</h2><h3 id="ä½¿ç”¨Barrieræ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ"><a href="#ä½¿ç”¨Barrieræ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ" class="headerlink" title="ä½¿ç”¨Barrieræ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ"></a>ä½¿ç”¨<code>Barrier</code>æ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ</h3><p>åœ¨<a href="http://objc.in/2016/08/24/iOS%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%EF%BC%9A%E9%87%8D%E6%B8%A9GCD%EF%BC%88%E4%B8%80%EF%BC%89/" target="_blank" rel="external">ä¸Šç¯‡æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»¬æœ€åæåˆ°äº†å¦‚ä½•åˆ©ç”¨<code>GCD</code>åˆ›å»ºçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ã€‚ä½†è¿™å…¶å®æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚è€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p>å¦‚æœæˆ‘ä»¬çš„å•ç²’ä¸­æœ‰è¿™æ ·çš„å¯å˜å±æ€§</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSMutableArray</span> *array;`</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬äº†è§£ï¼Œåœ¨<code>objc</code>ä¸­ï¼Œappleæ˜ç¡®å‘Šè¯‰æˆ‘ä»¬è¿™æ ·çš„å¯å˜é›†åˆéƒ½<strong>ä¸æ˜¯çº¿ç¨‹å®‰å…¨</strong>çš„ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬çš„å•ç²’åœ¨å¤šä¸ªçº¿ç¨‹ä¸­è¢«è¯»å†™ï¼Œå¾ˆå®¹æ˜“å°±å‘ç”Ÿæ•°æ®æ··ä¹±çš„é—®é¢˜ï¼</p>
<p><code>dispatch barrier</code>å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼</p>
<p>æ ¹æ®appleå®˜æ–¹æ–‡æ¡£ï¼š</p>
<blockquote>
<p>A dispatch barrier allows you to create a synchronization point within a concurrent dispatch queue. When it encounters a barrier, a concurrent queue delays the execution of the barrier block (or any further blocks) until all blocks submitted before the barrier finish executing. At that point, the barrier block executes by itself. Upon completion, the queue resumes its normal execution behavior.</p>
</blockquote>
<p>ç®€å•ç¿»è¯‘ä¸‹ï¼Œå¯è§<code>dispatch barrier</code>å…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—ä¸­åˆ›å»ºä¸€ä¸ª<strong>åŒæ­¥</strong>ç‚¹ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªä»»åŠ¡(<code>block</code>)ï¼Œå½“é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æŒ‰åºæ´¾å‘åˆ°è¿™é‡Œæ—¶ï¼Œå¹¶å‘é˜Ÿåˆ—ä¼šåœä¸‹ç­‰å¾…<code>barrier</code>ç‚¹å‰é¢çš„æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ¥ç€æ‰§è¡Œ<code>barrier block</code>ã€‚ç­‰<code>barrier block</code>æ‰§è¡Œå®Œæ¯•åç»§ç»­æ‰§è¡Œåé¢çš„ä»»åŠ¡:</p>
<p><img src="http://i2.buimg.com/572363/3af4576fb2897c06.png" alt="barrier"></p>
<p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åœ¨æ“ä½œè¿™ä¸ªæ•°ç»„ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨åŒæ—¶è¯»å–ï¼Œé‚£ä¸ä¼šå¼•èµ·é—®é¢˜ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹ä¸­åœ¨è¯»å–ï¼ŒåŒæ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­åœ¨å†™å…¥ï¼Œå°±ä¼šå¼•èµ·çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ï¼</p>
<p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¸æŠŠè¿™ä¸ªå±æ€§æš´éœ²åœ¨å¤–éƒ¨ï¼Œä½¿å¾—å¤–éƒ¨ä¸èƒ½ç›´æ¥å†™å…¥ï¼Œè€Œæ˜¯æä¾›ç»™å¤–éƒ¨ä¸€äº›æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- (<span class="keyword">void</span>)add:(<span class="keyword">id</span>)object;</div><div class="line">- (<span class="keyword">void</span>)remove:(<span class="keyword">id</span>)object;</div></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæˆ‘ä»¬åœ¨å†…éƒ¨åˆ©ç”¨<code>barrier</code>è¿›è¡Œå®‰å…¨çš„å†™å…¥ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)add:(<span class="keyword">id</span>)object&#123;</div><div class="line">	<span class="keyword">if</span>(!object) <span class="keyword">return</span>;</div><div class="line">	<span class="comment">//ä¿è¯å†™å…¥æ—¶ï¼Œä¸ä¼šè¢«é˜Ÿåˆ—ä¸­çš„å¼‚æ­¥æ“ä½œ"æ‰“æ‰°"</span></div><div class="line">	dispatch_barrier_async(<span class="keyword">self</span>.concurrentQueue, ^&#123; </div><div class="line">	[<span class="keyword">self</span>.array addObject:object];</div><div class="line">	</div><div class="line">	&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±ä¿è¯äº†åœ¨æ“ä½œå•ä¾‹ä¸­æ•°ç»„çš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šå‘ç”Ÿä»»ä½•å¼‚æ­¥è¡Œä¸ºï¼Œä¹Ÿå°±ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼</p>
<p>å¦å¤–éœ€è¦æ³¨æ„å¾—åœ°æ–¹æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä¸Šè¿°ä»£ç æ®µé‡Œä½¿ç”¨äº†<code>self.concurrentQueue</code>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šä½¿ç”¨<code>self.concurrentQueue</code>?</p>
<p>é¦–å…ˆè¦è¯´æ˜çš„æ˜¯ï¼Œ<code>self.concurrentQueue</code>æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å¹¶å‘é˜Ÿåˆ—ï¼Œå®ƒçš„åˆ›å»ºæ–¹å¼ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">self</span>.concurrentQueue = dispatch_queue_create(<span class="string">"com.selander.GooglyPuff.photoQueue"</span>,</div><div class="line">                                                    DISPATCH_QUEUE_CONCURRENT);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¼šå°†å•ç²’ä¸­çš„è¯»æ“ä½œä¹Ÿæ”¾åœ¨è¿™ä¸ªé˜Ÿåˆ—é‡Œï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSArray</span> *) array</div><div class="line">&#123;</div><div class="line">    __block <span class="built_in">NSArray</span> *array; </div><div class="line">    <span class="built_in">dispatch_sync</span>(<span class="keyword">self</span>.concurrentQueue, ^&#123; </div><div class="line">        array = [<span class="built_in">NSArray</span> arrayWithArray:_photosArray]; </div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> array;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæ‰èƒ½ä¿è¯åœ¨å†™æ“ä½œæ—¶å€™æ‹¦ä½å‰é¢çš„è¯»æ“ä½œï¼Œå› ä¸ºå®ƒä»¬éƒ½åœ¨ç”¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚å½“ç„¶ï¼Œ<strong>è¿™ä¸ªåœ°æ–¹å¿…é¡»ä½¿ç”¨<code>dispathc_sync</code>å‡½æ•°</strong>ï¼Œå¦‚æœå¼‚æ­¥è°ƒç”¨æ„å‘³ç€å‡½æ•°ä¸ä¼šç«‹å³è¿”å›ã€‚é‚£ä¹ˆåœ¨å¤–éƒ¨ä½¿ç”¨çš„å¾—åˆ°çš„æ•°ç»„æ—¶å°±å¯èƒ½ä¼šå‡ºé—®é¢˜,æ¯”å¦‚:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSMutableArray</span> *)array&#123;</div><div class="line">    </div><div class="line">     __block <span class="built_in">NSMutableArray</span> *tmpArray = <span class="literal">nil</span>;</div><div class="line">    </div><div class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.concurrentQueue, ^&#123;</div><div class="line">        tmpArray = [_array <span class="keyword">copy</span>];<span class="comment">//æ³¨æ„è¿™ä¸ªåœ°æ–¹å¯èƒ½åœ¨è¿”å›ä¹‹å‰è¿˜æ²¡æœ‰è°ƒç”¨ï¼</span></div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> tmpArray;<span class="comment">//tmpArrayå¯èƒ½ä¸ºnilï¼</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="barrierçš„API"><a href="#barrierçš„API" class="headerlink" title="barrierçš„API"></a><code>barrier</code>çš„<code>API</code></h3><p><code>barrier</code>æ˜¯ä¸ªå¾ˆæœ‰ç”¨çš„ç‰¹æ€§ï¼Œåœ¨appleçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæœ‰åˆ—å‡ºäº†ä¸‹åˆ—å‡½æ•°ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">void</span> dispatch_barrier_async( <span class="built_in">dispatch_queue_t</span> queue, </div><div class="line">									dispatch_block_t block);</div><div class="line"></div><div class="line"><span class="keyword">void</span> dispatch_barrier_async_f( <span class="built_in">dispatch_queue_t</span> queue, </div><div class="line">									<span class="keyword">void</span>* context, </div><div class="line">									dispatch_function_t work);</div><div class="line"></div><div class="line"><span class="keyword">void</span> dispatch_barrier_sync( <span class="built_in">dispatch_queue_t</span> queue, </div><div class="line">								    dispatch_block_t block);</div><div class="line"></div><div class="line"><span class="keyword">void</span> dispatch_barrier_sync_f( <span class="built_in">dispatch_queue_t</span> queue, </div><div class="line">									<span class="keyword">void</span>* context, </div><div class="line">									dispatch_function_t work);</div></pre></td></tr></table></figure>
<p>å…¶å®è¿˜æ˜¯å¾ˆæœ‰è§„å¾‹çš„ğŸ˜„ï¼š<code>async</code>ä¸<code>sync</code>ç›¸å¯¹è¡¨ç¤ºåŒæ­¥orå¼‚æ­¥ã€<code>async_f</code>ä¸<code>sync</code>ç›¸å¯¹è¡¨ç¤ºæ‰§è¡Œçš„æ˜¯<code>block</code>æˆ–è€…<code>dispatch_function_t</code>å¯¹è±¡ã€‚</p>
<p>ç”±äºç¯‡å¹…æœ‰é™ï¼Œåœ¨è¿™é‡Œå°±ä¸åœ¨è§£é‡Šäº†ã€‚åªç»™å‡ºç»“è®º: </p>
<ol>
<li><p>æ— è®ºæ˜¯<code>dispatch_barrier_sync</code>or <code>dispatch_barrier_async</code>å‡½æ•°ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ°<code>dispatch_barrier_sync_f</code>or<code>dispatch_barrier_async_f</code>ã€‚</p>
</li>
<li><p><code>dispatch_barrier_sync_f</code>å‡½æ•°ä¸­çš„<code>void* context</code>å‚æ•°å…¶å®å°±æ˜¯æˆ‘ä»¬ä¼ ç»™<code>dispatch_barrier_sync</code>å‡½æ•°ä¸­çš„<code>block</code>å¯¹è±¡ã€‚è€Œ<code>dispatch_function_t work</code>å‚æ•°æ˜¯<code>block</code>å¯¹è±¡é‡Œçš„å‡½æ•°æŒ‡é’ˆ(æ‡‚çš„äººè‡ªç„¶æ‡‚ğŸ˜„)ã€‚</p>
</li>
</ol>
<h3 id="barrierä½¿ç”¨å»ºè®®"><a href="#barrierä½¿ç”¨å»ºè®®" class="headerlink" title="barrierä½¿ç”¨å»ºè®®"></a><code>barrier</code>ä½¿ç”¨å»ºè®®</h3><p>è¦ç†è§£<code>barrier</code>æ‹¦ä½çš„æ˜¯é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>barrier</code>é’ˆå¯¹çš„é˜Ÿåˆ—ã€‚æ‰€ä»¥ä¸éš¾ç»™å‡ºä»¥ä¸‹å»ºè®®ï¼š</p>
<ol>
<li>ä¸è¦åœ¨è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—ä¸­ä½¿ç”¨ï¼šä¸€ä¸ªå¾ˆåçš„é€‰æ‹©ï¼Œéšœç¢ä¸ä¼šæœ‰ä»»ä½•å¸®åŠ©ï¼Œå› ä¸ºä¸ç®¡æ€æ ·ï¼Œä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸€æ¬¡éƒ½åªæ‰§è¡Œä¸€ä¸ªæ“ä½œã€‚</li>
<li>ä¸è¦åœ¨å…¨å±€å¹¶å‘é˜Ÿåˆ—ä¸­ä½¿ç”¨ï¼šè¦å°å¿ƒï¼Œè¿™å¯èƒ½ä¸æ˜¯æœ€å¥½çš„ä¸»æ„ï¼Œå› ä¸ºå…¶å®ƒç³»ç»Ÿå¯èƒ½åœ¨ä½¿ç”¨é˜Ÿåˆ—è€Œä¸”ä½ ä¸èƒ½å„æ–­å®ƒä»¬åªä¸ºä½ è‡ªå·±çš„ç›®çš„ã€‚</li>
<li>æœ€å¥½åœ¨è‡ªå®šä¹‰å¹¶å‘é˜Ÿåˆ—ä¸­ä½¿ç”¨ï¼šè¿™å¯¹äºåŸå­æˆ–ä¸´ç•ŒåŒºä»£ç æ¥è¯´æ˜¯æä½³çš„é€‰æ‹©ã€‚ä»»ä½•ä½ åœ¨è®¾ç½®æˆ–å®ä¾‹åŒ–çš„éœ€è¦çº¿ç¨‹å®‰å…¨çš„äº‹ç‰©éƒ½æ˜¯ä½¿ç”¨éšœç¢çš„æœ€ä½³å€™é€‰ã€‚</li>
</ol>
<h3 id="barrieréƒ¨åˆ†å°ç»“"><a href="#barrieréƒ¨åˆ†å°ç»“" class="headerlink" title="barrieréƒ¨åˆ†å°ç»“"></a><code>barrier</code>éƒ¨åˆ†å°ç»“</h3><p><strong>todo è¿™é‡Œä¹‹åç»™å‡ºæºç è§£è¯»æ–‡ç« åœ°å€</strong>å¦‚æœæƒ³è¦äº†è§£æ›´å¤šå…³äº<code>barrier</code>çš„å®ç°ç»†èŠ‚ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå·±ä¸‹è½½<code>GCD</code>æºç é˜…è¯»ï¼š<a href="http://opensource.apple.com/tarballs/libdispatch/libdispatch-442.1.4.tar.gz" target="_blank" rel="external">libdispatch</a>ã€‚</p>
<h2 id="è°ƒåº¦ç»„-Dispatch-Groups"><a href="#è°ƒåº¦ç»„-Dispatch-Groups" class="headerlink" title="è°ƒåº¦ç»„ | Dispatch Groups"></a>è°ƒåº¦ç»„ | Dispatch Groups</h2>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>è¯·æ¯å’–å•¡å–ï¼Ÿ</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>èµ</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://i1.buimg.com/572363/b21593e5f65ea204.jpg" alt="Zheng Li WeChat Pay"/>
          <p>å¾®ä¿¡æ‰“èµ</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="http://i1.buimg.com/572363/7caac38df4844f66.jpg" alt="Zheng Li Alipay"/>
          <p>æ”¯ä»˜å®æ‰“èµ</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/08/24/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰/" rel="next" title="iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰">
                <i class="fa fa-chevron-left"></i> iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆä¸€ï¼‰
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/"
           data-title="iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰.md" data-url="http://yoursite.com/2016/08/26/iOSä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šé‡æ¸©GCDï¼ˆäºŒï¼‰/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://tva3.sinaimg.cn/crop.0.0.511.511.180/006pqpL6jw8f4z97xky5nj30e70e8aai.jpg"
               alt="Zheng Li" />
          <p class="site-author-name" itemprop="name">Zheng Li</p>
          <p class="site-description motion-element" itemprop="description">iOSå¼€å‘èœé¸¡ï¼ŒåŠªåŠ›æé«˜è‡ªæˆ‘ä¸­ã€‚</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://yulingtianxia.com/" title="yulingtianxia" target="_blank">yulingtianxia</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://kyxu.tech/" title="kyXu" target="_blank">kyXu</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å¼•è¨€"><span class="nav-number">1.</span> <span class="nav-text">å¼•è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ …æ -Using-Barriers"><span class="nav-number">2.</span> <span class="nav-text">æ …æ  | Using Barriers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨Barrieræ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ"><span class="nav-number">2.1.</span> <span class="nav-text">ä½¿ç”¨Barrieræ„å»ºä¸€ä¸ªå®‰å…¨çš„è¯»å†™æ“ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#barrierçš„API"><span class="nav-number">2.2.</span> <span class="nav-text">barrierçš„API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#barrierä½¿ç”¨å»ºè®®"><span class="nav-number">2.3.</span> <span class="nav-text">barrierä½¿ç”¨å»ºè®®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#barrieréƒ¨åˆ†å°ç»“"><span class="nav-number">2.4.</span> <span class="nav-text">barrieréƒ¨åˆ†å°ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è°ƒåº¦ç»„-Dispatch-Groups"><span class="nav-number">3.</span> <span class="nav-text">è°ƒåº¦ç»„ | Dispatch Groups</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zheng Li</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"BJTUzhengli"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("28Bi52ufQCnrlpfv4vbx8JEG-gzGzoHsz", "1cAbB9JCSijqEURfv3Pa9uYd");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
